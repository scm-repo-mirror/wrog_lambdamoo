/******************************************************************************
  Copyright (c) 1992, 1995, 1996 Xerox Corporation.  All rights reserved.
  Portions of this code were written by Stephen White, aka ghond.
  Use and copying of this software and preparation of derivative works based
  upon this software are permitted.  Any distribution of this software or
  derivative works must comply with all applicable United States export
  control laws.  This software is made available AS IS, and Xerox Corporation
  makes no warranty about the software, its performance or its conformity to
  any specification.  Any person obtaining a copy of this software is requested
  to send their name and post office or electronic mail address to:
    Pavel Curtis
    Xerox PARC
    3333 Coyote Hill Rd.
    Palo Alto, CA 94304
    Pavel@Xerox.Com
 *****************************************************************************/

/*--------------------------------------*
 !!! WARNING about editing options.h  !!!
 *--------------------------------------*
options.h.in   is the template for options.h
options.h      is generated by ./configure,
               is read-only, and gets compiled into the server

(This text appears both places; know which file you're viewing.)

Option descriptions below are written as if one will edit options.h
because, prior to version 1.9.0, that's how it was done.  Things work
differently now.  See "Using ./configure to set options" in README.md.

Option descriptions in options.h.in may be confusing because they will
always be followed by '#undef's even when the options have non-#undef
defaults.  If options.h does not exist yet and you want to see what it
looks like, run ./configure (you can rerun it again later).

Developers should read options.ac and commentary beyond the
#endif below to learn how options now work.

(There remain cases where it might make sense to edit options.h.
However, even where editing is okay, if options.h.in or any other
prerequisite is touched, ./configure will automatically re-run and
overwrite whatever you did.  So these kinds of edits are likely not
useful for anything other than quick experiments.)

!!!   (end of warning)               !!!
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
*/

#ifndef Options_H
#define Options_H 1

/*-----------------*
 !  General Notes  |
 *-----------------*

(0) Options are C preprocessor names that this file will
    either #define to some value or leave #undef'ed.

(1) #defines here *always* have a value so that if somebody was sloppy
    (shouldn't happen, but it does) and used #if when they meant
    #ifdef, we don't lose.

(2) Some option values mean "I don't care" and get revised by
    options_epilog.h to some useful default.

    Sometimes the "I don't care" value is #undef,
    Sometimes the "I don't care" value is OPTION_DEFAULT
    if #undef needs to be reserved for Something Else.
    Backwards compatibility means we're not always consistent about
    using OPTION_DEFAULT (which was only introduced in 1.9.0)
    everywhere that it would make sense to do so.

    When in doubt, read the option description or look at options.ac
    to see if the default is 'no' (#undef) or '' (OPTION_DEFAULT).

(3) Be wary of options or option values marked "EXPERIMENTAL".

 *------------------*
 |  Actual Options  |
 *------------------*/

/******************************************************************************
 * INT_TYPE_BITSIZE explicitly fixes the size of the INT/NUM and OBJ
 * datatypes in bits, for situations where you need them to be a
 * particular size (e.g., legacy databases where arithmetic rollover
 * needs to happen in the right place).
 *
 * Current allowed values are 16, 32, and 64.  The default, if left
 * unset, is 64 if your platform has a 64-bit integer type and
 * otherwise 32.
 *
 * !! WARNING:  16 is EXPERIMENTAL; expect weirdness.
 *
 * Loading a database previously written by a server with larger
 * INT_TYPE_BITSIZE will fail there are out-of-range integers.
 */

#undef INT_TYPE_BITSIZE

/******************************************************************************
 * The server is prepared to keep a log of every command entered by players
 * since the last checkpoint.  The log is flushed whenever a checkpoint is
 * successfully begun and is dumped into the server log when and if the server
 * panics.  Define LOG_COMMANDS to enable this logging.
 */

#undef LOG_COMMANDS

/******************************************************************************
 * The server normally forks a separate process to make database checkpoints;
 * the original process continues to service user commands as usual while the
 * new process writes out the contents of its copy of memory to a disk file.
 * This checkpointing process can take quite a while, depending on how big your
 * database is, so it's usually quite convenient that the server can continue
 * to be responsive while this is taking place.  On some systems, however,
 * there may not be enough memory to support two simultaneously running server
 * processes.  Define UNFORKED_CHECKPOINTS to disable server forking for
 * checkpoints.
 */

#undef UNFORKED_CHECKPOINTS

/******************************************************************************
 * The MUD Client Protocol (MCP) defines a means for multiplexing out
 * of band data onto a player connection using a standard message format.
 * See http://www.moo.mud.org/mcp for details.  The following two options
 * are part of the implementation of that protocol for this server.
 *
 * These options only have effect if defined as non-empty strings, in which
 * case:
 *
 *  + Lines of player input beginning with OUT_OF_BAND_PREFIX
 *    bypass both normal command parsing and read() tasks to instead spawn
 *    #0:do_out_of_band_command(word-list) tasks.
 *
 *  + Lines of player input beginning with OUT_OF_BAND_QUOTE_PREFIX
 *    are first stripped of that prefix and then processed normally
 *    (i.e., as a command or read() line) even if the stripped line starts
 *    with OUT_OF_BAND_PREFIX, thus providing a means of escaping lines that
 *    would otherwise spawn out-of-band tasks.
 *
 * The default values are as specified in MCP 2.0 and should not need to be
 * changed, unless one wants to entirely disable the protocol, in which case
 * both options should be #undefined.  (Note that the protocol can already
 * be disabled on a per-connection basis using the connection option
 * "disable_oob")
 */

#undef OUT_OF_BAND_PREFIX
#undef OUT_OF_BAND_QUOTE_PREFIX

/******************************************************************************
 * The following constants define the execution limits placed on all MOO tasks.
 *
 * The *FG* constants are used only for `foreground' tasks (those started by
 * either player input or the server's initiative and that have never
 * suspended); the *BG* constants are used only for `background' tasks (forked
 * tasks and those of any kind that have suspended).
 */

/* DEFAULT_MAX_STACK_DEPTH is the default maximum depth allowed for the MOO
 *	verb-call stack, the maximum number of dynamically-nested calls at any
 *	given time.  If defined in the database and larger than this default,
 *	$server_options.max_stack_depth overrides this default.
 */

#undef DEFAULT_MAX_STACK_DEPTH

/* DEFAULT_FG_TICKS and DEFAULT_BG_TICKS are the default maximum numbers of
 *	`ticks' (basic operations) any task is allowed to use without
 *	suspending.  If defined in the database, $server_options.fg_ticks and
 *	$server_options.bg_ticks override these defaults.
 */

#undef DEFAULT_FG_TICKS
#undef DEFAULT_BG_TICKS

/* DEFAULT_FG_SECONDS and DEFAULT_BG_SECONDS are the default maximum numbers of
 *	real-time seconds any task is allowed to use without suspending.  If
 *	defined in the database, $server_options.fg_seconds and
 *	$server_options.bg_seconds override these defaults.
 */

#undef DEFAULT_FG_SECONDS
#undef DEFAULT_BG_SECONDS

/******************************************************************************
 * Debug settings:
 *
 * DEBUG_LOG_TRACEBACKS prints all tracebacks to the server log.
 */

#undef DEBUG_LOG_TRACEBACKS

/******************************************************************************
 * NETWORK_PROTOCOL must be defined as one of the following:
 *
 * NP_SINGLE	The server will accept only one user at a time, communicating
 *		with them using the standard input and output streams of the
 *		server itself.
 * NP_TCP	The server will use TCP/IP protocols, such as are used by the
 *		Internet `telnet' command.
 * NP_LOCAL	The server will use a non-networking mechanism, entirely local
 *		to the machine on which the server is running.  Depending on
 *		the value of NETWORK_STYLE, below, this will be either UNIX-
 *		domain sockets (NS_BSD) or named pipes (NS_SYSV).
 */

#undef NETWORK_PROTOCOL

/* If NP_TCP is selected, then DEFAULT_PORT is the TCP port number on which the
 * server listens when no port argument is given on the command line.
 */

#undef DEFAULT_PORT

/* If NP_LOCAL is selected, then DEFAULT_CONNECT_FILE is the name of the UNIX
 * pseudo-file through which the server will listen for connections when no
 * file name is given on the command line.
 */

#undef DEFAULT_CONNECT_FILE

/******************************************************************************
 * If NETWORK_PROTOCOL is not defined as NP_SINGLE, then NETWORK_STYLE must be
 * defined as one of the following:
 *
 * NS_BSD	The server will use implementation techniques appropriate to a
 *		BSD-style UNIX system.
 * NS_SYSV	The server will use implementation techniques appropriate to an
 *		AT&T UNIX System V system.
 */

#undef NETWORK_STYLE

/******************************************************************************
 * If NETWORK_PROTOCOL is not defined as NP_SINGLE, then MPLEX_STYLE must be
 * defined as one of the following:
 *
 * MP_SELECT	The server will assume that the select() system call exists.
 * MP_POLL	The server will assume that the poll() system call exists and
 *		that, if NETWORK_PROTOCOL is NP_LOCAL above, it works for
 *		named pipes (FIFOs).
 * MP_FAKE	The server will use a nasty trick that works only if you've
 *		defined NETWORK_PROTOCOL as NP_LOCAL and NETWORK_STYLE as
 *		NS_SYSV above.
 *
 * Usually, it works best to leave MPLEX_STYLE undefined and let the code at
 * the bottom of this file pick the right value.
 */

#undef MPLEX_STYLE

/******************************************************************************
 * The built-in MOO function open_network_connection(), when enabled,
 * allows (only) wizard-owned MOO code to make outbound network connections
 * from the server.  When disabled, it raises E_PERM whenever called.
 *
 * SECURITY WARNING: If your server will be hosting untrusted users,
 *   and in-database checks on use of this function are inadequate,
 *   then enabling this function will have security implications for
 *   your local network.
 *
 * Whether open_network_connection() is enabled or disabled
 * is controlled by the server command line +O and -O options
 * and the definition given here:
 *
 * (#undef)     always disabled, +O logs a warning but has no effect.
 *  OBN_OFF     disabled by default, +O enables
 *  OBN_ON      enabled by default,  -O disables
 *
 * OUTBOUND_NETWORK is only relevant when NETWORK_PROTOCOL == NP_TCP;
 * open_network_connection() is not available otherwise.
 *
 * (note: prior server versions used explicit numerical values
 *  in place of OBN_OFF/OBN_ON; do not rely on these going forward).
 */

#undef OUTBOUND_NETWORK

/******************************************************************************
 * The following constants define certain aspects of the server's network
 * behavior if NETWORK_PROTOCOL is not defined as NP_SINGLE.
 *
 * MAX_QUEUED_OUTPUT is the maximum number of output characters the
 *   server is willing to buffer for any given network connection
 *   before discarding old output to make way for new.  The server
 *   only discards output after attempting to send as much as possible
 *   on the connection without blocking.
 */

#undef MAX_QUEUED_OUTPUT

/* MAX_QUEUED_INPUT is the maximum number of input characters the
 *   server is willing to buffer from any given network connection
 *   before it stops reading from the connection at all.  The server
 *   starts reading from the connection again once most of the
 *   buffered input is consumed.
 */

#undef MAX_QUEUED_INPUT

/* DEFAULT_CONNECT_TIMEOUT is the default number of seconds an
 *   un-logged-in connection is allowed to remain idle without being
 *   forcibly closed by the server; this can be overridden by defining
 *   the `connect_timeout' property on $server_options or on L, for
 *   connections accepted by a given listener L.
 */

#undef DEFAULT_CONNECT_TIMEOUT

/******************************************************************************
 * On connections that have not been set to binary mode, the server normally
 * discards incoming characters that are not printable ASCII, including
 * backspace (8) and delete(127).  If INPUT_APPLY_BACKSPACE is defined,
 * backspace and delete cause the preceding character (if any) to be removed
 * from the input stream.  (Comment this out to restore pre-1.8.3 behavior)
 */

#undef INPUT_APPLY_BACKSPACE

/******************************************************************************
 * The server maintains a cache of the most recently used patterns from calls
 * to the match() and rmatch() built-in functions.  PATTERN_CACHE_SIZE controls
 * how many past patterns are remembered by the server.  Do not set it to a
 * number less than 1.
 */

#undef PATTERN_CACHE_SIZE

/******************************************************************************
 * Prior to 1.8.4 property lookups were required on every reference to a
 * built-in property due to the possibility of that property being protected.
 * This used to be expensive.  IGNORE_PROP_PROTECTED thus existed to entirely
 * disable the use of $server_options.protect_<property> for those who
 * did not actually make use of protected builtin properties.  Since all
 * protect_<property> options are now cached, this #define is now deprecated.
 */

#undef IGNORE_PROP_PROTECTED

/******************************************************************************
 * The code generator can now recognize situations where the code will not
 * refer to the value of a variable again and generate opcodes that will
 * keep the interpreter from holding references to the value in the runtime
 * environment variable slot.  Before, when doing something like x=f(x), the
 * interpreter was guaranteed to have a reference to the value of x while f()
 * was running, meaning that f() always had to copy x to modify it.  With
 * BYTECODE_REDUCE_REF enabled, f() could be called with the last reference
 * to the value of x.  So for example, x={@x,y} can (if there are no other
 * references to the value of x in variables or properties) just append to
 * x rather than make a copy and append to that.  If it *does* have to copy,
 * the next time (if it's in a loop) it will have the only reference to the
 * copy and then it can take advantage.
 *
 * NOTE WELL    NOTE WELL    NOTE WELL    NOTE WELL    NOTE WELL
 *
 * This option affects the length of certain bytecode sequences.
 * Suspended tasks in a database from a server built with this option
 * are not guaranteed to work with a server built without this option,
 * and vice versa.  It is safe to flip this switch only if there are
 * no suspended tasks in the database you are loading.  (It might work
 * anyway, but hey, it's your database.)  This restriction will be
 * lifted in a future version of the server software.  Consider this
 * option as being BETA QUALITY until then.
 *
 * NOTE WELL    NOTE WELL    NOTE WELL    NOTE WELL    NOTE WELL
 */

#undef BYTECODE_REDUCE_REF

/******************************************************************************
 * The server can merge duplicate strings on load to conserve memory.  This
 * involves a rather expensive step at startup to dispose of the table used
 * to find the duplicates.  This should be improved eventually, but you may
 * want to trade off faster startup time for increased memory usage.
 *
 * You might want to turn this off if you see a large delay before the
 * INTERN: lines in the log at startup.
 */

#undef STRING_INTERNING

/******************************************************************************
 * Store the length of the string WITH the string rather than recomputing
 * it each time it is needed.
 */

#undef MEMO_STRLEN

/******************************************************************************
 * DEFAULT_MAX_LIST_CONCAT,   if set to a positive value, is the length
 *                            of the largest constructible list.
 * DEFAULT_MAX_STRING_CONCAT, if set to a positive value, is the length
 *                            of the largest constructible string.
 * Limits on "constructible" values apply to values built by concatenation,
 * splicing, subrange assignment and various builtin functions.
 * If defined in the database, $server_options.max_list_concat and
 * and $server_options.max_string_concat override these defaults.
 * A zero value disables limit checking.
 *
 * $server_options.max_concat_catchable, if defined, causes an E_QUOTA error
 * to be raised when an overly-large value is spotted.  Otherwise, the task
 * is aborted as if it ran out of seconds (see DEFAULT_FG_SECONDS),
 * which was the original behavior in this situation (i.e., if we
 * were lucky enough to avoid a server memory allocation panic).
 */

#undef DEFAULT_MAX_LIST_CONCAT
#undef DEFAULT_MAX_STRING_CONCAT

/* In order to avoid weirdness from these limits being set too small,
 * we impose the following (arbitrary) respective minimum values.
 * That is, a positive value for $server_options.max_list_concat that
 * is less than MIN_LIST_CONCAT_LIMIT will be silently increased, and
 * likewise for the string limit.
 */

#undef MIN_LIST_CONCAT_LIMIT
#undef MIN_STRING_CONCAT_LIMIT

/******************************************************************************
 * Pragmas are a proposed future server feature that will *not* be
 * implemented as an option (meaning this option WILL LIKELY BE REMOVED
 * in a future release)..  Until then, this is here as a way of
 * testing out certain alternate function and operator behaviors
 * and can be set to a mask of flags indicating which are enabled.
 *
 * The current list of flags that matter is in options_epilog.h.
 */

#undef PRAGMAS

/******************************************************************************
 * Continue on to the part that ./configure should not be touching ...
 */

#include "options_epilog.h"

#endif		/* !Options_H */

/*------------------------------*
 |  About editing options.h.in  |
 *------------------------------*

In options.h.in, all options are #undef.

When creating options.h, ./configure (config.status, actually) reads
options.h.in and, in accordance with the configure arguments or the
default values in options.ac, replaces each bare #undef line with
either a #define or a comment.  All other text is copied verbatim.
(It's the same mechanism as for config.h.in -> config.h)

To change an option's default setting:

(*) Edit options.ac
(*) Make sure options_epilog.h can cope with the new default
(*) Update options.ac helptext and options.h.in description
(*) Rerun autoconf

If autoconf is not available and you want to change a default:

(1) If the new default is anything other than #undef, replacing #undef
    with a #define in options.h.in does what you'd expect on the next
    ./configure run (the #define, not being an #undef, will be
    ignored and sail through unchanged).

    To make the new default #undef, **comment it out** in options.h.in
    so that config.status can't find it (and change it).

(2) An alternative (which I will mention but highly discourage) is to
    edit options_epilog.h, which, coming after options.h and being the
    LAST opportunity to edit option values, has the advantage that
    there will be no further hidden mechanisms at work so that you'll
    know what you're getting.  With these sorts of changes, you can do
    what you like since they won't be going back into the server
    distribution.  But you will probably want to ALSO edit commentary
    in options.h.in to remind yourself what you're doing so as not to
    be confused 6 months later.
*/

/*
 * $Log$
 * Revision 2.5  1996/03/19  07:13:35  pavel
 * Changed CONNECT_TIMEOUT into DEFAULT_CONNECT_TIMEOUT.  Release 1.8.0p2.
 *
 * Revision 2.4  1996/03/10  01:12:55  pavel
 * Added definitions of DEFAULT_PORT and DEFAULT_CONNECT_FILE, moved here
 * from elsewhere.  Release 1.8.0.
 *
 * Revision 2.3  1996/02/08  06:15:51  pavel
 * Updated copyright notice for 1996.  Release 1.8.0beta1.
 *
 * Revision 2.2  1995/12/31  00:06:58  pavel
 * Clarified that OUTBOUND_NETWORK may not be defined for non-TCP
 * configurations.  Release 1.8.0alpha4.
 *
 * Revision 2.1  1995/12/11  08:07:02  pavel
 * Moved USE_GNU_MALLOC to a less prominent place in the file.
 * Release 1.8.0alpha2.
 *
 * Revision 2.0  1995/11/30  04:53:59  pavel
 * New baseline version, corresponding to release 1.8.0alpha1.
 *
 * Revision 1.11  1992/10/23  23:03:47  pavel
 * Added copyright notice.
 *
 * Revision 1.10  1992/10/23  22:21:10  pavel
 * Fixed MPLEX_STYLE-defaulting code to avoid assuming that select() always
 * works on FIFOs by conditionalizing on SELECT_WORKS_ON_FIFOS rather than
 * HAVE_SELECT.
 *
 * Revision 1.9  1992/10/21  03:02:35  pavel
 * Converted to use new automatic configuration system.
 *
 * Revision 1.8  1992/10/17  20:20:16  pavel
 * Generalize treatment of system-dependent replacements for rand().
 * Allow for systems that don't have rename() and/or remove().
 *
 * Revision 1.7  1992/10/06  18:23:07  pavel
 * Dyked out useless XNS support and fixed a bug in the default definition of
 * MPLEX_STYLE.
 *
 * Revision 1.6  1992/09/23  17:16:25  pavel
 * Added definitions of NETWORK_PROTOCOL etc. to support new networking
 * architecture.
 *
 * Revision 1.5  1992/09/11  21:17:54  pavel
 * Reset to refrain from defining SINGLE_USER in the distribution.
 *
 * Revision 1.4  1992/09/03  23:52:45  pavel
 * Added support for multiple complete network implementations.
 *
 * Revision 1.3  1992/08/21  01:01:22  pavel
 * Radically reorganized and verbosely commented to make it easy for people to
 * understand what all of the configuration options mean.
 *
 * Moved all of the -DFOO options out of the Makefile and into here.
 *
 * Revision 1.2  1992/08/20  17:33:54  pavel
 * Added #define for OUT_OF_BAND_PREFIX.
 *
 * Revision 1.1  1992/07/20  23:23:12  pavel
 * Initial RCS-controlled version.
 */
